<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Individual</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dashboard.css">
</head>

<body>
  <div class="individual-dashboard">
    <aside class="individual-dashboard__sidebar">
      <div class="individual-dashboard__brand">
        <img src="images/imagen blanca.png" alt="Wellbeing logo" class="individual-dashboard__logo">
      </div>
      <div class="individual-dashboard__profile-card">
        <div class="individual-dashboard__profile-avatar">
          <img src="images/avatar-default.svg" alt="Avatar del usuario" class="individual-dashboard__profile-avatar-image" data-user-avatar>
        </div>
        <div class="individual-dashboard__profile-text">
          <p class="individual-dashboard__profile-eyebrow">Miembro individual</p>
          <h2 class="individual-dashboard__profile-name"><span data-user-name>Maria Thompson</span></h2>
          <p class="individual-dashboard__profile-meta">Miembro desde marzo 2023</p>
        </div>
      </div>
      <div class="individual-dashboard__plan-card">
        <header class="individual-dashboard__plan-header">
          <span class="individual-dashboard__plan-label">Plan actual</span>
          <span class="individual-dashboard__plan-status">Activo</span>
        </header>
        <h3 class="individual-dashboard__plan-name">Family Protect Plus</h3>
        <p class="individual-dashboard__plan-meta">Salud ‚Ä¢ Visi√≥n ‚Ä¢ Dental</p>
        <dl class="individual-dashboard__plan-list">
          <div>
            <dt>Cobertura</dt>
            <dd>Hasta $100,000</dd>
          </div>
          <div>
            <dt>Pr√≥ximo pago</dt>
            <dd>15 Oct 2025</dd>
          </div>
        </dl>
        <button class="button ghost-button">Ver detalles</button>
      </div>
      <nav class="individual-dashboard__menu">
        <a class="active" href="individual-dashboard.html">Inicio</a>
        <a href="my-profile.html">Mi perfil</a>
        <a href="manage-my-plan.html">Mi plan</a>
        <a href="payments.html">Pagos</a>
        <a href="settings.html">Ajustes</a>
      </nav>
      <div class="individual-dashboard__sidebar-footer">
        <button class="button outline-button logout">Cerrar sesi√≥n</button>
      </div>
    </aside>
    <main class="individual-dashboard__main">
      <header class="individual-hero">
        <div class="individual-hero__info">
          <div class="individual-hero__avatar">
            <img src="images/avatar-default.svg" alt="Avatar del usuario" class="individual-hero__avatar-image" data-user-avatar>
          </div>
          <div class="individual-hero__copy">
            <p class="individual-hero__eyebrow">Bienvenida de nuevo</p>
            <h1 class="individual-hero__title"><span data-user-name>Maria Thompson</span></h1>
            <p class="individual-hero__subtitle">Tu plan Family Protect Plus est√° activo y cubre atenci√≥n m√©dica, visi√≥n y dental para toda tu familia.</p>
          </div>
        </div>
        <div class="individual-hero__actions">
          <button class="button solid-button">Gestionar mi plan</button>
          <button class="button ghost-button">Actualizar mis datos</button>
        </div>
      </header>
      <section class="individual-metrics">
        <article class="metric-card">
          <span class="metric-card__label">Estado del plan</span>
          <span class="metric-card__value metric-card__value--success">Activo</span>
          <p class="metric-card__meta">Renovado el 18 de abril de 2025</p>
        </article>
        <article class="metric-card">
          <span class="metric-card__label">Cobertura disponible</span>
          <span class="metric-card__value">$100,000</span>
          <p class="metric-card__meta">Incluye servicios de salud, visi√≥n y dental</p>
        </article>
        <article class="metric-card">
          <span class="metric-card__label">Pr√≥ximo pago</span>
          <span class="metric-card__value">15 Oct 2025</span>
          <p class="metric-card__meta">Cargo autom√°tico programado</p>
        </article>
      </section>
      <section class="individual-content">
        <article class="panel">
          <header class="panel__header">
            <h2 class="panel__title">Tareas r√°pidas</h2>
            <p class="panel__subtitle">Completa estas acciones sugeridas para mantener tu plan al d√≠a.</p>
          </header>
          <ul class="tasks-list">
            <li class="tasks-list__item">
              <span class="tasks-list__badge">1</span>
              <div class="tasks-list__content">
                <h3>Agregar beneficiario secundario</h3>
                <p>Agrega un contacto alternativo para acelerar cualquier reclamo.</p>
              </div>
              <button class="button outline-button">Agregar</button>
            </li>
            <li class="tasks-list__item">
              <span class="tasks-list__badge">2</span>
              <div class="tasks-list__content">
                <h3>Subir comprobante de residencia</h3>
                <p>Verifica que tu direcci√≥n est√© actualizada para recibir correspondencia.</p>
              </div>
              <button class="button outline-button">Subir</button>
            </li>
            <li class="tasks-list__item">
              <span class="tasks-list__badge">3</span>
              <div class="tasks-list__content">
                <h3>Configurar alertas de pago</h3>
                <p>Recibe recordatorios por correo o SMS antes de cada vencimiento.</p>
              </div>
              <button class="button outline-button">Configurar</button>
            </li>
          </ul>
        </article>
        <article class="panel">
          <header class="panel__header">
            <h2 class="panel__title">Beneficiarios</h2>
            <p class="panel__subtitle">Gestiona qui√©n recibir√° tu cobertura si la necesitas.</p>
          </header>
          <div class="beneficiary-card">
            <h3 class="beneficiary-card__name">Andr√©s Rodriguez</h3>
            <p class="beneficiary-card__relation">C√≥nyuge ‚Ä¢ 100% asignado</p>
            <p class="beneficiary-card__contact">+1 (312) 555-3421 ‚Ä¢ andres.rodriguez@email.com</p>
            <div class="beneficiary-card__actions">
              <button class="button ghost-button">Actualizar datos</button>
              <button class="button outline-button">Cambiar porcentaje</button>
            </div>
          </div>
        </article>
        <article class="panel panel--documents">
          <header class="panel__header">
            <h2 class="panel__title">Documentos de identidad</h2>
            <p class="panel__subtitle">Tu verificaci√≥n est√° casi completa, solo falta un documento.</p>
          </header>
          <ul class="documents-status">
            <li class="documents-status__item">
              <div class="documents-status__info">
                <h3>Pasaporte</h3>
                <p>Subido el 2 de abril de 2025</p>
              </div>
              <span class="status-pill status-pill--success">Aprobado</span>
              <button class="button ghost-button">Reemplazar</button>
            </li>
            <li class="documents-status__item">
              <div class="documents-status__info">
                <h3>Licencia de conducir</h3>
                <p>Vence el 14 de agosto de 2025</p>
              </div>
              <span class="status-pill status-pill--warning">Por vencer</span>
              <button class="button ghost-button">Actualizar</button>
            </li>
            <li class="documents-status__item">
              <div class="documents-status__info">
                <h3>Tarjeta de seguro social</h3>
                <p>No se ha cargado ning√∫n archivo</p>
              </div>
              <span class="status-pill status-pill--neutral">Pendiente</span>
              <button class="button ghost-button">Subir</button>
            </li>
          </ul>
        </article>
        <article class="panel panel--wide">
          <header class="panel__header">
            <h2 class="panel__title">Soporte y pr√≥ximos pasos</h2>
            <p class="panel__subtitle">Tu equipo de cuidado est√° disponible para ayudarte cuando lo necesites.</p>
          </header>
          <div class="support-grid">
            <div class="support-grid__item">
              <h3>Agenda una llamada</h3>
              <p>Coordina una reuni√≥n virtual con un especialista de bienestar familiar.</p>
              <button class="button solid-button">Reservar</button>
            </div>
            <div class="support-grid__item">
              <h3>Mensajes seguros</h3>
              <p>Revisa la bandeja de entrada para responder a tu enfermera de cabecera.</p>
              <button class="button outline-button">Ir a mensajes</button>
            </div>
            <div class="support-grid__item">
              <h3>Centro de ayuda</h3>
              <p>Encuentra gu√≠as y preguntas frecuentes sobre coberturas y reembolsos.</p>
              <button class="button ghost-button">Ver art√≠culos</button>
            </div>
          </div>
        </article>
      </section>
    </main>
  </div>
  <script src="i18n.js"></script>
  <script src="app.js"></script>

  ...
<script src="i18n.js"></script>
<script src="app.js"></script>

<!-- üí° Pega ESTE script ac√°, inmediatamente antes de </body> -->
<script>
document.addEventListener('DOMContentLoaded', async () => {
  console.log('[Memora] script carg√≥'); // debug
  const API_BASE = 'https://memoracare.org/wp-json';
  const $  = (s, c=document) => c.querySelector(s);
  const $$ = (s, c=document) => Array.from(c.querySelectorAll(s));

  function titleCaseEmail(email){
    if(!email) return 'Usuario';
    const base = email.split('@')[0].replace(/[._-]+/g,' ');
    return base.split(' ').map(w=> w? w[0].toUpperCase()+w.slice(1) : '').join(' ');
  }
  function formatDateISO(iso){
    if(!iso) return '-';
    const d = new Date(iso);
    return isNaN(d) ? '-' : d.toLocaleDateString('es-AR',{day:'2-digit',month:'short',year:'numeric'}).replace('.', '');
  }
  function planUI(plan){
    const p = (plan||'').toLowerCase();
    if (p==='bussines'||p==='business'||p==='corporate') return {badge:'Miembro empresarial', plan:'Corporate', dest:'/business-dashboard.html'};
    if (p==='personal'||p==='individual'||p==='familiar') return {badge:'Miembro individual', plan:'Individual / Familiar', dest:'/individual-dashboard.html'};
    return {badge:'Sin membres√≠a', plan:'‚Äî', dest:'/'};
  }
  function statusUI(s){
    const x = (s||'').toLowerCase();
    if (x==='active'||x==='wc-active') return {label:'Activo', ok:true};
    if (x==='on-hold'||x==='pending') return {label:'En pausa', ok:false};
    if (x==='cancelled'||x==='expired') return {label:'Inactivo', ok:false};
    return {label:'Desconocido', ok:false};
  }

  const token = sessionStorage.getItem('memora_token');
  if(!token){ console.warn('[Memora] no hay token, voy a login'); location.href='/login.html'; return; }

  let me = null;
  try { me = JSON.parse(sessionStorage.getItem('memora_user')||'null'); } catch(_){}
  try {
    const r = await fetch(`${API_BASE}/memora/v1/me`, { headers:{ Authorization: 'Bearer '+token }});
    console.log('[Memora] /me status =', r.status);
    if(r.ok){ me = await r.json(); sessionStorage.setItem('memora_user', JSON.stringify(me)); }
    else if (!me) { throw new Error('No autenticado'); }
  } catch(e){
    console.warn('[Memora] no pude traer /me', e);
    if(!me){ location.href='/login.html'; return; }
  }

  console.log('[Memora] me =', me); // ‚ñ∂Ô∏è deber√≠as ver email/plan/status

  const displayName = me.display || me.name || titleCaseEmail(me.email);

  // Pintar nombre (targets t√≠picos + data-user-name)
  const nameTargets = ['[data-user-name]','.individual-dashboard__profile-name','.profile-name','#user-name','.user-name'];
  let painted = false;
  for(const sel of nameTargets){ $$(sel).forEach(el=>{ el.textContent = displayName; painted = true; }); }
  if(!painted){
    // Reemplazo de texto hardcodeado "Maria Thompson"
    $$('h1,h2,h3,.title,.name,.profile,.header,p,span,div').forEach(el=>{
      if(el.childElementCount===0 && (el.textContent||'').trim().toLowerCase()==='maria thompson'){
        el.textContent = displayName; painted = true;
      }
    });
  }

  // Plan/estado
  const p = planUI(me.plan);
  const s = statusUI(me.status);
  const eyebrow = $('.individual-dashboard__profile-eyebrow');
  if(eyebrow) eyebrow.textContent = p.badge;
  const planNameEl = $('.individual-dashboard__plan-name');
  if(planNameEl) planNameEl.textContent = p.plan;
  const planStatusEl = $('.individual-dashboard__plan-status');
  if(planStatusEl) planStatusEl.textContent = s.label;

  const metricStatus = $('.metric-card .metric-card__value');
  if(metricStatus){
    metricStatus.textContent = s.label;
    metricStatus.classList.toggle('metric-card__value--success', !!s.ok);
  }

  const nextPayEls = $$('.individual-dashboard .metric-card:nth-child(3) .metric-card__value, .individual-dashboard__plan-list dd:nth-of-type(2)');
  nextPayEls.forEach(el => el.textContent = formatDateISO(me.expires_at));

  const logoutBtn = document.querySelector('.logout');
  if (logoutBtn) logoutBtn.addEventListener('click', ()=>{
    sessionStorage.removeItem('memora_token');
    sessionStorage.removeItem('memora_user');
    location.href='/login.html';
  });
});
</script>

</body>
</html>


